<!DOCTYPE html>
<html lang="fr">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9299852089790980"
     crossorigin="anonymous"></script>
  <link rel="icon" href="/img/favicon.ico" sizes="any">
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WHOIS</title>
  <meta name="description" content="WaveTools : WHOIS.">
  <meta name="robots" content="index, follow">
  <meta http-equiv="content-language" content="fr">
  <meta name="author" content="WaveTools">
  <link rel="canonical" href="https://www.wavetools.fr">
  <link rel="stylesheet" href="/includes/style.css">
</head>
<body>
<canvas id="siteBg"></canvas>
<script src="/includes/anime.js"></script>
<div id="header"></div>
<main class="wt-main">

<!-- ****************************************************************************************************** -->
<!--
<div class="tool-layout">
  <aside class="tool-ads">
    <div class="ad-box">PUB GAUCHE</div>
  </aside>
-->
 <main class="tool-main">
  <section class="shell-section">
    <div class="ip-card">
      <h1 class="tool-title">WHOIS</h1>

      <div class="terminal-body">
        <div class="line">
          Domaine / IP :
          <input id="q" placeholder="ex: example.com" value="example.com">
        </div>

        <button class="copy-btn" id="btnSearch">Rechercher</button>

        <div class="line">Statut : <span id="status">—</span></div>

        <div class="line" style="margin-top:10px;">Domain Profile</div>

        <div id="profile">
          <div class="kv"><b>Registrar</b><span id="registrar">—</span></div>
          <div class="kv"><b>IANA ID</b><span id="iana">—</span></div>
          <div class="kv"><b>WHOIS / RDAP</b><span id="rdap">—</span></div>

          <div class="kv"><b>Créé le</b><span id="created">—</span></div>
          <div class="kv"><b>Expire le</b><span id="expires">—</span></div>
          <div class="kv"><b>Mis à jour</b><span id="updated">—</span></div>

          <div class="kv"><b>Domain Status</b><span id="dstatus">—</span></div>
          <div class="kv"><b>DNSSEC</b><span id="dnssec">—</span></div>
          <div class="kv"><b>Name Servers</b><span id="ns">—</span></div>
        </div>
      </div>

      <button class="copy-btn" id="btnCopy">Copier le résultat</button>
    </div>
  </section>
</main>

<!--
  <aside class="tool-ads">
    <div class="ad-box">PUB DROITE</div>
  </aside>
</div>
-->

<script>
const $ = (id)=>document.getElementById(id);

function cleanQuery(q){
  q=(q||"").trim().replace(/^https?:\/\//i,"").split("/")[0];
  return q;
}
function isIP(q){ return q.includes(":") || /^[0-9]{1,3}(\.[0-9]{1,3}){3}$/.test(q); }

function setTxt(id,v){
  $(id).textContent = (v===undefined || v===null || v==="" ) ? "—" : v;
}

function setLoading(){
  setTxt("status","Recherche...");
  ["registrar","iana","rdap","created","expires","updated","dstatus","dnssec","ns"].forEach(id=>setTxt(id,"Détection..."));
}

function vcardFN(entity){
  // RDAP vCard: ["vcard", [ ["fn", {}, "text", "Name"], ... ]]
  const arr = entity?.vcardArray?.[1];
  if(!Array.isArray(arr)) return null;
  const fn = arr.find(x => x[0] === "fn");
  return fn ? fn[3] : null;
}

function findRegistrar(data){
  const ents = data?.entities;
  if(!Array.isArray(ents)) return null;

  // cherche entity role "registrar"
  const reg = ents.find(e => Array.isArray(e.roles) && e.roles.includes("registrar"));
  if(reg) return vcardFN(reg) || null;

  // fallback: first entity fn
  return vcardFN(ents[0]) || null;
}

function findIanaId(data){
  // parfois dans remarks / notices / ou pas dispo
  // On tente de le détecter dans des textes
  const scan = (arr)=>{
    if(!Array.isArray(arr)) return null;
    for(const r of arr){
      const desc = r?.description;
      if(Array.isArray(desc)){
        for(const line of desc){
          const m = String(line).match(/IANA\s*ID\s*[:#]?\s*(\d+)/i);
          if(m) return m[1];
        }
      }
    }
    return null;
  };
  return scan(data?.remarks) || scan(data?.notices) || null;
}

function pickEventDate(data, keys){
  if(!Array.isArray(data?.events)) return null;
  for(const k of keys){
    const ev = data.events.find(e => String(e.eventAction||"").toLowerCase() === k);
    if(ev?.eventDate) return ev.eventDate;
  }
  return null;
}

function formatList(arr){
  if(!Array.isArray(arr) || !arr.length) return "—";
  return arr.filter(Boolean).join(" | ");
}

function copyText(text){
  navigator.clipboard.writeText(text).catch(()=>{});
}

let lastCopy = "";

async function run(){
  const q = cleanQuery($("q").value);
  if(!q) return;

  setLoading();

  try{
    const url = isIP(q) ? `https://rdap.org/ip/${encodeURIComponent(q)}` : `https://rdap.org/domain/${encodeURIComponent(q)}`;
    const res = await fetch(url, {cache:"no-store"});
    if(!res.ok) throw new Error("Introuvable / refusé");
    const data = await res.json();

    setTxt("status","OK");

    // Registrar / IANA / RDAP link
    setTxt("registrar", findRegistrar(data));
    setTxt("iana", findIanaId(data));               // pas toujours dispo en RDAP
    setTxt("rdap", url);

    // Dates
    setTxt("created", pickEventDate(data, ["registration","registered"]));
    setTxt("expires", pickEventDate(data, ["expiration","expire"]));
    setTxt("updated", pickEventDate(data, ["last changed","last update","changed"]));

    // Status / DNSSEC / NS
    setTxt("dstatus", formatList(data?.status));
    setTxt("dnssec", data?.secureDNS?.delegationSigned === true ? "Signed" :
                     data?.secureDNS?.delegationSigned === false ? "Not signed" : "—");

    const nss = Array.isArray(data?.nameservers) ? data.nameservers.map(n => n.ldhName).filter(Boolean) : [];
    setTxt("ns", nss.length ? nss.join(" | ") : "—");

    // Prépare un texte "copiable" (résumé)
    lastCopy =
`Query: ${q}
Registrar: ${$("registrar").textContent}
IANA ID: ${$("iana").textContent}
RDAP: ${$("rdap").textContent}
Created: ${$("created").textContent}
Expires: ${$("expires").textContent}
Updated: ${$("updated").textContent}
Status: ${$("dstatus").textContent}
DNSSEC: ${$("dnssec").textContent}
Name Servers: ${$("ns").textContent}`;

  }catch(e){
    setTxt("status","Erreur");
    ["registrar","iana","rdap","created","expires","updated","dstatus","dnssec","ns"].forEach(id=>setTxt(id,"—"));
    lastCopy = "";
  }
}

$("btnSearch").addEventListener("click", run);
$("q").addEventListener("keydown", (e)=>{ if(e.key==="Enter") run(); });
$("btnCopy").addEventListener("click", ()=> copyText(lastCopy || "—"));

</script>

<!-- ****************************************************************************************************** -->

</main>
<div id="footer"></div>
<script src="/includes/load.js"></script>
<script src="/includes/auto.js"></script>
</body>
</html>