<!DOCTYPE html>
<html lang="fr">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9299852089790980"
     crossorigin="anonymous"></script>
  <link rel="icon" href="/img/favicon.ico" sizes="any">
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WHOIS</title>
  <meta name="description" content="WaveTools : WHOIS.">
  <meta name="robots" content="index, follow">
  <meta http-equiv="content-language" content="fr">
  <meta name="author" content="WaveTools">
  <link rel="canonical" href="https://www.wavetools.fr">
  <link rel="stylesheet" href="/includes/style.css">
</head>
<body>
<canvas id="siteBg"></canvas>
<script src="/includes/anime.js"></script>
<div id="header"></div>
<main class="wt-main">

<!-- ****************************************************************************************************** -->
<!--
<div class="tool-layout">
  <aside class="tool-ads">
    <div class="ad-box">PUB GAUCHE</div>
  </aside>
-->
  <main class="tool-main">
  <section class="shell-section">
    <div class="ip-card">
      <h1 class="tool-title">WHOIS</h1>

      <div class="terminal-body">
        <div class="line">
          Domaine / IP :
          <input id="q" placeholder="ex: example.com ou 8.8.8.8" value="example.com">
        </div>

        <button class="copy-btn" id="btnSearch">Rechercher</button>

        <div class="line">Statut : <span id="status">—</span></div>

        <div class="line">Résumé :</div>
        <div class="line">Registrar : <span id="registrar">—</span></div>
        <div class="line">Créé : <span id="created">—</span></div>
        <div class="line">Expire : <span id="expires">—</span></div>
        <div class="line">Mis à jour : <span id="updated">—</span></div>
        <div class="line">Name servers : <span id="ns">—</span></div>

        <div class="line">Record complet :</div>
        <pre id="raw">—</pre>
      </div>

      <button class="copy-btn" id="btnCopy">Copier le résultat</button>
    </div>
  </section>
</main>

<!--
  <aside class="tool-ads">
    <div class="ad-box">PUB DROITE</div>
  </aside>
</div>
-->

<script>
const $ = (id)=>document.getElementById(id);

function cleanQuery(q){
  q=(q||"").trim().replace(/^https?:\/\//i,"").split("/")[0];
  return q;
}
function isIP(q){ return q.includes(":") || /^[0-9]{1,3}(\.[0-9]{1,3}){3}$/.test(q); }

function setLoading(){
  $("status").textContent="Recherche...";
  ["registrar","created","expires","updated","ns"].forEach(id=>$(id).textContent="Détection...");
  $("raw").textContent="Détection...";
}

function pickEventDate(data, keyWords){
  // RDAP events: [{eventAction, eventDate}]
  if(!data || !Array.isArray(data.events)) return null;
  for(const kw of keyWords){
    const ev = data.events.find(e => (e.eventAction||"").toLowerCase() === kw);
    if(ev && ev.eventDate) return ev.eventDate;
  }
  return null;
}

async function run(){
  const q = cleanQuery($("q").value);
  if(!q) return;

  setLoading();

  try{
    const url = isIP(q) ? `https://rdap.org/ip/${encodeURIComponent(q)}` : `https://rdap.org/domain/${encodeURIComponent(q)}`;
    const res = await fetch(url, {cache:"no-store"});
    if(!res.ok) throw new Error("Introuvable / refusé");
    const data = await res.json();

    $("status").textContent="OK";

    // Registrar (souvent dans entities)
    let registrar = null;
    if(Array.isArray(data.entities)){
      const regEntity = data.entities.find(e => (e.roles||[]).includes("registrar"));
      if(regEntity) registrar = regEntity.vcardArray?.[1]?.find(x=>x[0]==="fn")?.[3] || null;
    }
    $("registrar").textContent = registrar || "—";

    $("created").textContent = pickEventDate(data, ["registration","registered"]) || "—";
    $("expires").textContent = pickEventDate(data, ["expiration","expire"]) || "—";
    $("updated").textContent = pickEventDate(data, ["last changed","last update","changed"]) || "—";

    // Name servers
    const nss = Array.isArray(data.nameservers) ? data.nameservers.map(n=>n.ldhName).filter(Boolean) : [];
    $("ns").textContent = nss.length ? nss.join(" | ") : "—";

    $("raw").textContent = JSON.stringify(data, null, 2);

  }catch(e){
    $("status").textContent="Erreur";
    ["registrar","created","expires","updated","ns"].forEach(id=>$(id).textContent="—");
    $("raw").textContent="—";
  }
}

function copyResult(){
  navigator.clipboard.writeText($("raw").textContent || "").catch(()=>{});
}

$("btnSearch").addEventListener("click", run);
$("btnCopy").addEventListener("click", copyResult);
$("q").addEventListener("keydown", (e)=>{ if(e.key==="Enter") run(); });
</script>

<!-- ****************************************************************************************************** -->

</main>
<div id="footer"></div>
<script src="/includes/load.js"></script>
<script src="/includes/auto.js"></script>
</body>
</html>