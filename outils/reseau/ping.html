<!DOCTYPE html>
<html lang="fr">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9299852089790980"
     crossorigin="anonymous"></script>
  <link rel="icon" href="/img/favicon.ico" sizes="any">
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vérification de la propagation DNS</title>
  <meta name="description" content="WaveTools : vérification de la propagation DNS.">
  <meta name="robots" content="index, follow">
  <meta http-equiv="content-language" content="fr">
  <meta name="author" content="WaveTools">
  <link rel="canonical" href="https://www.wavetools.fr">
  <link rel="stylesheet" href="/includes/style.css">
</head>
<body>
<canvas id="siteBg"></canvas>
<script src="/includes/anime.js"></script>
<div id="header"></div>
<main class="wt-main">

<!-- ****************************************************************************************************** -->
<!--
<div class="tool-layout">
  <aside class="tool-ads">
    <div class="ad-box">PUB GAUCHE</div>
  </aside>
-->

<main class="tool-main">
<section class="shell-section">
<div class="ip-card">

<h1 class="tool-title">Ping</h1>

<div class="terminal-body">

<div class="line">
IP / Hôte : <input id="host" placeholder="1.1.1.1" value="1.1.1.1">
</div>

<button class="copy-btn" id="btnPing">Lancer</button>

<div class="line">Statut : <span id="status">—</span></div>
<div class="line">Résumé : <span id="summary">—</span></div>

<div class="line">Résultats :</div>
<div id="results"><div class="line">—</div></div>

</div>

<button class="copy-btn" id="btnCopy">Copier le résultat</button>

</div>
</section>
</main>

<!--
  <aside class="tool-ads">
    <div class="ad-box">PUB DROITE</div>
  </aside>
</div>
-->

<script>
const $ = id => document.getElementById(id);

function setTxt(id,v){ $(id).textContent = v ?? "—"; }
function clearOut(){ $("results").innerHTML = ""; }
function addLine(t){
  const d = document.createElement("div");
  d.className = "line";
  d.textContent = t;
  $("results").appendChild(d);
}

let lastCopy = "";

async function run(){
  const host = ($("host").value || "").trim();
  if(!host) return;

  setTxt("status","Ping...");
  setTxt("summary","Détection...");
  clearOut();
  addLine("Détection...");

  try{
    // 1) lancer ping
    const start = await fetch(`https://check-host.net/check-ping?host=${encodeURIComponent(host)}&max_nodes=5`);
    const job = await start.json();

    const requestId = job.request_id;

    // attendre résultat
    await new Promise(r=>setTimeout(r,2000));

    const res = await fetch(`https://check-host.net/check-result/${requestId}`);
    const data = await res.json();

    clearOut();

    let all = [];
    let ok = 0;

    for(const node in data){
      const r = data[node];
      if(!r || !r[0]){
        addLine(`${node} : timeout`);
        continue;
      }

      const ms = r[0][1];
      addLine(`${node} : ${ms} ms`);
      all.push(ms);
      ok++;
    }

    if(all.length){
      const min = Math.min(...all);
      const max = Math.max(...all);
      const avg = Math.round(all.reduce((a,b)=>a+b,0)/all.length);

      setTxt("status","OK");
      setTxt("summary",`min ${min} ms | moy ${avg} ms | max ${max} ms`);
    }else{
      setTxt("status","Timeout");
      setTxt("summary","Aucune réponse");
    }

    lastCopy =
`Ping ${host}

` + $("results").innerText;

  }catch(e){
    setTxt("status","Erreur");
    setTxt("summary","—");
    clearOut();
    addLine("Erreur API");
    lastCopy = "";
  }
}

function copy(){
  navigator.clipboard.writeText(lastCopy || "—").catch(()=>{});
}

$("btnPing").addEventListener("click", run);
$("host").addEventListener("keydown", e=>{ if(e.key==="Enter") run(); });
$("btnCopy").addEventListener("click", copy);
  </script>

<!-- ****************************************************************************************************** -->

</main>
<div id="footer"></div>
<script src="/includes/load.js"></script>
<script src="/includes/auto.js"></script>
</body>
</html>