<!DOCTYPE html>
<html lang="fr">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9299852089790980"
     crossorigin="anonymous"></script>
  <link rel="icon" href="/img/favicon.ico" sizes="any">
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GÃ©olocalisation IP</title>
  <meta name="description" content="WaveTools : gÃ©olocalisation d'une IP.">
  <meta name="robots" content="index, follow">
  <meta http-equiv="content-language" content="fr">
  <meta name="author" content="WaveTools">
  <link rel="canonical" href="https://www.wavetools.fr">
  <link rel="stylesheet" href="/includes/style.css">
</head>
<body>
<canvas id="siteBg"></canvas>
<script src="/includes/anime.js"></script>
<div id="header"></div>
<main class="wt-main">

<!-- ****************************************************************************************************** -->
<!--
<div class="tool-layout">
  <aside class="tool-ads">
    <div class="ad-box">PUB GAUCHE</div>
  </aside>
-->
   <main class="tool-main">
    <section class="shell-section">
      <div class="ip-card">
        <h1 class="tool-title">GÃ©olocaliser une IP</h1>

        <div class="terminal-body">
          <div class="line">
            IP :
            <input id="ipInput" placeholder="Ex: 8.8.8.8" value="8.8.8.8" />
          </div>

          <button class="copy-btn" id="btnSearch">Rechercher</button>

          <div class="line">Pays : <span id="country">â€”</span></div>
          <div class="line">Ville : <span id="city">â€”</span></div>
          <div class="line">RÃ©gion : <span id="region">â€”</span></div>
          <div class="line">FAI : <span id="org">â€”</span></div>
          <div class="line">Latitude : <span id="lat">â€”</span></div>
          <div class="line">Longitude : <span id="lon">â€”</span></div>

          <div class="line">Carte :</div>

          <!-- IMPORTANT: display:block + height forcÃ©e (si ton CSS Ã©crase) -->
          <iframe
            id="mapFrame"
            style="display:none !important;width:100%;height:320px;border:0;margin-top:10px;border-radius:10px;"
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
          ></iframe>
        </div>

        <button class="copy-btn" id="btnCopy">Copier le rÃ©sultat</button>
      </div>
    </section>
  </main>
<!--
  <aside class="tool-ads">
    <div class="ad-box">PUB DROITE</div>
  </aside>
</div>
-->

<script>
    console.log("âœ… Script chargÃ©");

    const $ = (id) => document.getElementById(id);

    function setText(id, v) {
      $(id).textContent = (v === undefined || v === null || v === "") ? "N/A" : v;
    }

    function setLoading() {
      setText("country", "DÃ©tection...");
      setText("city", "DÃ©tection...");
      setText("region", "DÃ©tection...");
      setText("org", "DÃ©tection...");
      setText("lat", "DÃ©tection...");
      setText("lon", "DÃ©tection...");
      $("mapFrame").src = "about:blank";
    }

    async function geoIP() {
      const ip = $("ipInput").value.trim();
      if (!ip) return alert("Entre une IP.");

      console.log("ðŸ”Ž Recherche IP:", ip);
      setLoading();

      try {
        // Test simple de connectivitÃ©
        const url = `https://ipapi.co/${encodeURIComponent(ip)}/json/`;
        console.log("âž¡ï¸ fetch:", url);

        const res = await fetch(url, { cache: "no-store" });
        console.log("â¬…ï¸ status:", res.status);

        const data = await res.json();
        console.log("ðŸ“¦ data:", data);

        if (data && data.error) {
          throw new Error(data.reason || "IP invalide / requÃªte refusÃ©e");
        }

        setText("country", data.country_name);
        setText("city", data.city);
        setText("region", data.region);
        setText("org", data.org);
        setText("lat", data.latitude);
        setText("lon", data.longitude);

        // Carte Google embed
        if (data.latitude && data.longitude) {
          const mapURL = `https://maps.google.com/maps?q=${data.latitude},${data.longitude}&z=10&output=embed`;
          console.log("ðŸ—ºï¸ map:", mapURL);
          $("mapFrame").src = mapURL;
        } else {
          $("mapFrame").src = "about:blank";
        }

      } catch (e) {
        console.error("âŒ Erreur geoIP:", e);
        alert("Erreur : " + (e.message || "Impossible de gÃ©olocaliser cette IP."));
        ["country","city","region","org","lat","lon"].forEach(id => setText(id, "â€”"));
        $("mapFrame").src = "about:blank";
      }
    }

    function copyResult() {
  const ip = $("ipInput").value.trim() || "â€”";
  const txt =
`IP: ${ip}
Pays: ${$("country").textContent}
Ville: ${$("city").textContent}
RÃ©gion: ${$("region").textContent}
FAI: ${$("org").textContent}
Latitude: ${$("lat").textContent}
Longitude: ${$("lon").textContent}`;

  navigator.clipboard.writeText(txt).catch(() => {});
}

    // On bind les events (plus fiable que onclick="")
    $("btnSearch").addEventListener("click", geoIP);
    $("btnCopy").addEventListener("click", copyResult);

    // EntrÃ©e = rechercher
    $("ipInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") geoIP();
    });
</script>

<!-- ****************************************************************************************************** -->

</main>
<div id="footer"></div>
<script src="/includes/load.js"></script>
<script src="/includes/auto.js"></script>
</body>
</html>