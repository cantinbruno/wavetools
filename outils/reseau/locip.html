<!DOCTYPE html>
<html lang="fr">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9299852089790980"
     crossorigin="anonymous"></script>
  <link rel="icon" href="/img/favicon.ico" sizes="any">
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Géolocalisation IP</title>
  <meta name="description" content="WaveTools : géolocalisation d'une IP.">
  <meta name="robots" content="index, follow">
  <meta http-equiv="content-language" content="fr">
  <meta name="author" content="WaveTools">
  <link rel="canonical" href="https://www.wavetools.fr">
  <link rel="stylesheet" href="/includes/style.css">
</head>
<body>
<canvas id="siteBg"></canvas>
<script src="/includes/anime.js"></script>
<div id="header"></div>
<main class="wt-main">

<!-- ****************************************************************************************************** -->
<!--
<div class="tool-layout">
  <aside class="tool-ads">
    <div class="ad-box">PUB GAUCHE</div>
  </aside>
-->
 <main class="tool-main">
    <section class="shell-section">
      <div class="ip-card">
        <h1 class="tool-title">Géolocaliser une IP</h1>

        <div class="terminal-body">
          <div class="line">
            IP :
            <input id="ipInput" placeholder="Ex: 8.8.8.8" />
            <button class="copy-btn" onclick="geoIP()">Rechercher</button>
          </div>

          <div class="line">Pays : <span id="country">—</span></div>
          <div class="line">Ville : <span id="city">—</span></div>
          <div class="line">Région : <span id="region">—</span></div>
          <div class="line">FAI : <span id="org">—</span></div>
<div class="line">Carte :</div>

<iframe
  id="mapFrame"
  width="100%"
  height="320"
  style="border:0;margin-top:8px;border-radius:10px;display:none;"
  loading="lazy">
</iframe>

        <button class="copy-btn" onclick="copyResult()">Copier le résultat</button>
      </div>
    </section>
  </main>
<!--
  <aside class="tool-ads">
    <div class="ad-box">PUB DROITE</div>
  </aside>
</div>
-->

<script>
    const setText = (id, value) => {
      document.getElementById(id).textContent = (value === undefined || value === null || value === "") ? "N/A" : value;
    };

    function setLoading() {
      setText("country", "Détection…");
      setText("city", "Détection…");
      setText("region", "Détection…");
      setText("org", "Détection…");
      setText("lat", "Détection…");
      setText("lon", "Détection…");

      const frame = document.getElementById("mapFrame");
      frame.style.display = "none";
      frame.src = "";
    }

    async function geoIP() {
      const ip = document.getElementById("ipInput").value.trim();
      if (!ip) return alert("Entre une IP.");

      setLoading();

      try {
        // API gratuite (sans clé)
        const res = await fetch(`https://ipapi.co/${encodeURIComponent(ip)}/json/`);
        const data = await res.json();

        // Gestion d'erreur ipapi
        if (data && data.error) {
          throw new Error(data.reason || "IP invalide ou requête refusée");
        }

        setText("country", data.country_name);
        setText("city", data.city);
        setText("region", data.region);
        setText("org", data.org);
        setText("lat", data.latitude);
        setText("lon", data.longitude);

        // Carte Google intégrée (iframe)
        if (data.latitude && data.longitude) {
          const mapURL = `https://maps.google.com/maps?q=${data.latitude},${data.longitude}&z=10&output=embed`;
          const frame = document.getElementById("mapFrame");
          frame.src = mapURL;
          frame.style.display = "block";
        } else {
          // pas de coords -> pas de carte
          const frame = document.getElementById("mapFrame");
          frame.style.display = "none";
          frame.src = "";
        }

      } catch (e) {
        alert("Erreur : " + (e.message || "Impossible de géolocaliser cette IP."));
        setText("country", "—");
        setText("city", "—");
        setText("region", "—");
        setText("org", "—");
        setText("lat", "—");
        setText("lon", "—");
        const frame = document.getElementById("mapFrame");
        frame.style.display = "none";
        frame.src = "";
      }
    }

    function copyResult() {
      const ip = document.getElementById("ipInput").value.trim() || "—";
      const txt =
`IP: ${ip}
Pays: ${document.getElementById("country").textContent}
Ville: ${document.getElementById("city").textContent}
Région: ${document.getElementById("region").textContent}
FAI: ${document.getElementById("org").textContent}
Latitude: ${document.getElementById("lat").textContent}
Longitude: ${document.getElementById("lon").textContent}`;

      navigator.clipboard.writeText(txt).then(
        () => alert("Résultat copié !"),
        () => alert("Copie impossible (permissions/navigateur).")
      );
    }

    // Bonus: Entrée = lancer la recherche
    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && document.activeElement && document.activeElement.id === "ipInput") {
        geoIP();
      }
    });
</script>

<!-- ****************************************************************************************************** -->

</main>
<div id="footer"></div>
<script src="/includes/load.js"></script>
<script src="/includes/auto.js"></script>
</body>
</html>